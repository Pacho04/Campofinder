{% extends 'base.html' %}

{% block content %}
{% if not cancha %}
  <h2>Cancha no encontrada</h2>
  <p>La cancha solicitada no existe.</p>
{% else %}
  <div style="max-width:800px; margin:20px auto; background:#fff; padding:20px; border-radius:8px;">
    <h1>{{ cancha.nombre }}</h1>
    <img src="{{ url_for('static', filename=cancha.imagen_url|replace(' ', '%20')) }}" alt="{{ cancha.nombre }}" style="width:100%; max-height:420px; object-fit:cover; border-radius:8px;" />
    <p style="margin-top:12px;">{{ cancha.descripcion }}</p>
    <p style="font-weight:800;">{{ cancha.precio }}</p>

    <h3>Reservar</h3>
    <form id="reserva-form">
      <input type="hidden" name="cancha_id" value="{{ cancha.id }}" />
      <label>Fecha: <input type="date" name="fecha" required value="{{ None }}"></label><br/><br/>
      <label>Horario: <input type="text" name="horario" placeholder="Ej: 18:00 - 19:00" required></label><br/><br/>
      <label>Mensaje: <input type="text" name="mensaje" placeholder="Opcional"></label><br/><br/>
      <button type="submit">Reservar ahora</button>
    </form>

    <div id="reserva-result" style="margin-top:12px;"></div>
  </div>

  <script>
    document.getElementById('reserva-form').addEventListener('submit', async function(e){
      e.preventDefault();
      const form = e.target;
      const data = {
        cancha: parseInt(form.cancha_id.value) || null,
        fecha: form.fecha.value,
        horario: form.horario.value,
        mensaje: form.mensaje.value
      };

      const res = await fetch('/api/reservar', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });

      const result = await res.json();
      const out = document.getElementById('reserva-result');
      if (res.ok) {
        out.innerHTML = '<span style="color:green;">' + (result.message || 'Reserva creada') + '</span>';
      } else {
        out.innerHTML = '<span style="color:red;">' + (result.error || JSON.stringify(result)) + '</span>';
      }
    });
  </script>
{% endif %}
{% endblock %}
